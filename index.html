<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相似字練習卷生成器</title>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 引入字體 (Noto Serif TC 和 標楷體風格) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* 自定義字體設定 */
        body { font-family: "Noto Sans TC", sans-serif; }
        .font-serif { font-family: "Noto Serif TC", "BiauKai", "DFKai-SB", serif; }
        
        /* --- 核心修復：列印專用樣式 (絕對定位覆蓋法) --- */
        @media print {
            /* 1. 隱藏 body 下的所有直接子元素 */
            body > * {
                display: none !important;
            }

            /* 2. 但保持 #root 顯示 (因為內容在裡面)，並重置它的佈局 */
            body > #root {
                display: block !important;
                position: static !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* 3. 隱藏 React App 內部的操作介面 */
            /* 使用更具體的選擇器來確保隱藏 */
            .main-container > .mobile-nav,
            .main-container > .content-wrapper > .sidebar-container,
            button,
            .print-hide {
                display: none !important;
            }

            /* 4. 關鍵：將試卷內容「提昇」並定位到頁面最頂端 */
            #worksheet-content {
                display: block !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                
                /* 強制顯示所有內容，包含子元素 */
                visibility: visible !important;
                
                /* 重置背景與顏色 */
                background-color: white !important;
                color: black !important;
                box-shadow: none !important;
                border: none !important;
                
                /* 確保背景圖形（如格線）被印出 */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* 5. 確保中間的容器不會擋住或限制高度 */
            .main-container, .content-wrapper, .preview-container {
                display: block !important;
                height: auto !important;
                overflow: visible !important;
                position: static !important;
                margin: 0 !important;
                padding: 0 !important;
                visibility: visible !important; /* 確保父層可見，否則子層可能被隱藏 */
            }

            /* 6. 防止題組被切斷 */
            .break-inside-avoid {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            /* 7. 設定紙張 */
            @page {
                size: A4;
                margin: 10mm;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- SVG 圖示組件 ---
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const IconPrinter = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>;
        const IconFileText = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>;
        const IconEraser = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"></path><path d="M22 21H7"></path><path d="m5 11 9 9"></path></svg>;
        const IconLayout = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>;
        const IconEdit = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>;

        const App = () => {
            const [groups, setGroups] = useState([
                { id: 1, chars: ['辨', '辯', '瓣'] },
                { id: 2, chars: ['己', '已', '巳'] },
                { id: 3, chars: ['戊', '戌', '戍'] },
                { id: 4, chars: ['未', '末'] },
            ]);
            const [inputValue, setInputValue] = useState('');
            const [worksheetTitle, setWorksheetTitle] = useState('相似字辨析練習');
            const [activeTab, setActiveTab] = useState('edit');

            const handleAddGroup = (e) => {
                e.preventDefault();
                if (!inputValue.trim()) return;
                const chars = inputValue.split(/[\s,，、]+/).filter(c => c.trim() !== '');
                if (chars.length > 0) {
                    const newGroup = { id: Date.now(), chars: chars };
                    setGroups([...groups, newGroup]);
                    setInputValue('');
                }
            };

            const handleRemoveGroup = (id) => {
                setGroups(groups.filter(group => group.id !== id));
            };

            const handlePrint = () => {
                // 直接呼叫，避免因非同步造成的阻擋
                window.print();
            };

            return (
                <div className="h-screen flex flex-col bg-gray-100 font-sans text-gray-800 overflow-hidden main-container">
                    
                    {/* 手機版導航 */}
                    <div className="md:hidden bg-white border-b border-gray-200 p-2 flex justify-around items-center shrink-0 mobile-nav">
                        <button onClick={() => setActiveTab('edit')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${activeTab === 'edit' ? 'bg-blue-100 text-blue-700' : 'text-gray-500'}`}>
                            <IconEdit /> 編輯題目
                        </button>
                        <button onClick={() => setActiveTab('preview')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${activeTab === 'preview' ? 'bg-blue-100 text-blue-700' : 'text-gray-500'}`}>
                            <IconLayout /> 檢視試卷
                        </button>
                    </div>

                    {/* 內容區塊 */}
                    <div className="flex flex-1 overflow-hidden relative content-wrapper">
                        {/* 左側操作區 */}
                        <div className={`sidebar-container w-full md:w-1/3 max-w-md bg-white border-r border-gray-200 flex flex-col z-20 ${activeTab === 'edit' ? 'block' : 'hidden md:flex'}`}>
                            <div className="p-6 border-b border-gray-100 shrink-0">
                                <h1 className="text-2xl font-bold text-blue-600 mb-2 flex items-center gap-2">
                                    <IconFileText /> 練習卷產生器
                                </h1>
                                <p className="text-gray-500 text-sm">輸入相似字，自動排版成A4試卷。</p>
                            </div>

                            <div className="p-6 overflow-y-auto flex-1 space-y-6">
                                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">試卷標題</label>
                                    <input type="text" value={worksheetTitle} onChange={(e) => setWorksheetTitle(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                </div>

                                <form onSubmit={handleAddGroup} className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <label className="block text-sm font-medium text-blue-800 mb-1">新增相似字組</label>
                                    <div className="flex gap-2">
                                        <input type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)} placeholder="如: 戊 戌 戍 (空白隔開)" className="flex-1 px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                        <button type="submit" className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center">
                                            <IconPlus />
                                        </button>
                                    </div>
                                </form>

                                <div>
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="font-semibold text-gray-700">題目列表 ({groups.length})</h3>
                                        {groups.length > 0 && (
                                            <button onClick={() => setGroups([])} className="text-xs text-red-500 hover:text-red-700 flex items-center gap-1">
                                                <IconEraser /> 清空
                                            </button>
                                        )}
                                    </div>
                                    <div className="space-y-2">
                                        {groups.map((group) => (
                                            <div key={group.id} className="flex items-center justify-between bg-white p-3 rounded border border-gray-200 shadow-sm hover:border-blue-300 transition-colors">
                                                <div className="flex gap-2 flex-wrap">
                                                    {group.chars.map((char, idx) => (
                                                        <span key={idx} className="bg-gray-100 px-2 py-1 rounded text-lg font-serif text-gray-800">{char}</span>
                                                    ))}
                                                </div>
                                                <button onClick={() => handleRemoveGroup(group.id)} className="text-gray-400 hover:text-red-500 p-2 rounded-full hover:bg-red-50">
                                                    <IconTrash />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            <div className="p-4 border-t border-gray-200 bg-white shrink-0">
                                <button onClick={handlePrint} className="w-full bg-green-600 text-white py-3 rounded-lg shadow hover:bg-green-700 transition-colors flex items-center justify-center gap-2 font-bold text-lg active:scale-95 transform duration-100">
                                    <IconPrinter /> 列印試卷 (A4)
                                </button>
                            </div>
                        </div>

                        {/* 右側預覽區 */}
                        <div className={`preview-container flex-1 bg-gray-200 overflow-y-auto flex justify-center p-4 md:p-8 ${activeTab === 'preview' ? 'block' : 'hidden md:flex'}`}>
                            <div id="worksheet-content" className="bg-white shadow-2xl mx-auto box-border relative" style={{ width: '210mm', minHeight: '297mm', padding: '20mm', backgroundColor: 'white' }}>
                                <div className="border-b-2 border-black pb-4 mb-8">
                                    <h1 className="text-3xl font-serif font-bold text-center tracking-widest mb-4 text-black">{worksheetTitle}</h1>
                                    <div className="flex justify-between text-lg font-serif text-black">
                                        <span>班級：__________</span>
                                        <span>姓名：__________</span>
                                        <span>座號：__________</span>
                                        <span>分數：__________</span>
                                    </div>
                                </div>

                                {/* 使用 grid-cols-2 強制雙欄排版 */}
                                <div className="grid grid-cols-2 gap-x-10 gap-y-10">
                                    {groups.length === 0 ? (
                                        <div className="col-span-full text-center text-gray-300 py-20 font-serif text-2xl print-hide select-none">
                                            (預覽區域)<br /><span className="text-sm">請在左側輸入題目</span>
                                        </div>
                                    ) : (
                                        groups.map((group, gIdx) => (
                                            <div key={group.id} className="break-inside-avoid">
                                                <div className="flex items-start gap-4 mb-2">
                                                    <span className="text-xl font-bold font-serif pt-2 text-black shrink-0">{gIdx + 1}.</span>
                                                    <div className="flex-1 border-l-4 border-gray-200 pl-4 py-1 space-y-4">
                                                        {group.chars.map((char, cIdx) => (
                                                            <div key={cIdx} className="flex items-end gap-2">
                                                                <div className="flex items-center shrink-0">
                                                                    <div className="w-14 h-14 border-2 border-black flex items-center justify-center text-4xl font-serif bg-white text-black leading-none">{char}</div>
                                                                    
                                                                    {/* 注音格：修改處 */}
                                                                    <div className="w-10 h-14 border-y-2 border-r-2 border-black relative bg-white shrink-0">
                                                                        {/* 水平橫線 (置中) */}
                                                                        <div className="absolute top-1/2 left-0 w-full border-t border-black opacity-30"></div>
                                                                    </div>

                                                                </div>
                                                                <div className="pb-3 text-xl font-serif font-bold text-black">：</div>
                                                                <div className="flex-1 flex items-end">
                                                                    <div className="border-b-2 border-black w-full h-10 relative">
                                                                        {cIdx === 0 && (
                                                                            <span className="absolute bottom-2 left-2 text-gray-200 text-xs print-hide select-none">( 造詞 )</span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>

                                <div className="absolute bottom-4 right-8 text-xs text-gray-400 font-serif print-hide">教師專用版</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>